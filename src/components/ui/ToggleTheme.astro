<div class="theme-switch-wrapper md:flex md:items-center">
  <label
    data-testid="theme-switch"
    class="theme-switch relative flex min-h-[44px] min-w-[44px] cursor-pointer items-center justify-center"
    for="checkbox"
    aria-label="Przełącz na tryb ciemny"
  >
    <input type="checkbox" id="checkbox" class="hidden" />
    <div
      class="slider relative h-[34px] w-[60px] rounded-full bg-black before:absolute before:bottom-[4px] before:left-[4px] before:h-[26px] before:w-[26px] before:rounded-full before:bg-orange before:transition-[0.4s] motion-reduce:before:transition-none dark:bg-white"
    >
    </div>
  </label>
</div>

<style>
  input:checked + .slider:before {
    transform: translateX(26px);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function ready() {
    const button = document.querySelector(
      '.theme-switch input[type="checkbox"]'
    ) as HTMLInputElement;
    const label = document.querySelector('.theme-switch') as HTMLLabelElement;

    const updateAriaLabel = () => {
      if (document.documentElement.classList.contains("dark")) {
        label.setAttribute("aria-label", "Przełącz na tryb jasny");
      } else {
        label.setAttribute("aria-label", "Przełącz na tryb ciemny");
      }
    };

    const switchTheme = () => {
      document.documentElement.classList.toggle("dark");
      if (document.documentElement.classList.contains("dark")) {
        localStorage.setItem("theme", "dark");
      } else {
        localStorage.setItem("theme", "light");
      }
      updateAriaLabel();
    };

    const applyTheme = (isDark: boolean) => {
      const hasDarkClass = document.documentElement.classList.contains("dark");
      if (isDark && !hasDarkClass) {
        document.documentElement.classList.add("dark");
      } else if (!isDark && hasDarkClass) {
        document.documentElement.classList.remove("dark");
      }
      updateAriaLabel();
    };

    if (
      localStorage.theme === "dark" ||
      (!("theme" in localStorage) &&
        window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
      switchTheme();
    }

    button.addEventListener("click", () => {
      switchTheme();
    });

    // Listen for OS theme preference changes
    window
      .matchMedia("(prefers-color-scheme: dark)")
      .addEventListener("change", (e) => {
        // Only apply OS preference if user hasn't explicitly set a theme
        if (!("theme" in localStorage)) {
          applyTheme(e.matches);
        }
      });
  });
</script>
