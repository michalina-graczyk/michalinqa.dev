<div class="theme-switch-wrapper md:flex md:items-center">
  <label
    data-testid="theme-switch"
    class="theme-switch relative inline-block h-[34px] w-[60px]"
    for="checkbox"
  >
    <input type="checkbox" id="checkbox" class="hidden" />
    <div
      class="slider absolute bottom-0 left-0 right-0 top-0 cursor-pointer rounded-full bg-black before:absolute before:bottom-[4px] before:left-[4px] before:h-[26px] before:w-[26px] before:rounded-full before:bg-orange before:transition-[0.4s] dark:bg-white"
    >
    </div>
  </label>
</div>

<style>
  input:checked + .slider:before {
    transform: translateX(26px);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function ready() {
    const button = document.querySelector(
      '.theme-switch input[type="checkbox"]'
    ) as HTMLInputElement;

    const switchTheme = () => {
      document.documentElement.classList.toggle("dark");
      if (document.documentElement.classList.contains("dark")) {
        localStorage.setItem("theme", "dark");
      } else {
        localStorage.setItem("theme", "light");
      }
    };

    const applyTheme = (isDark: boolean) => {
      const hasDarkClass = document.documentElement.classList.contains("dark");
      if (isDark && !hasDarkClass) {
        document.documentElement.classList.add("dark");
      } else if (!isDark && hasDarkClass) {
        document.documentElement.classList.remove("dark");
      }
    };

    if (
      localStorage.theme === "dark" ||
      (!("theme" in localStorage) &&
        window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
      switchTheme();
    }

    button.addEventListener("click", () => {
      switchTheme();
    });

    // Listen for OS theme preference changes
    window
      .matchMedia("(prefers-color-scheme: dark)")
      .addEventListener("change", (e) => {
        // Only apply OS preference if user hasn't explicitly set a theme
        if (!("theme" in localStorage)) {
          applyTheme(e.matches);
        }
      });
  });
</script>
