---
import ToggleTheme from "@components/ui/ToggleTheme.astro";
import { Astronav, MenuIcon, MenuItems } from "astro-navbar";

const currentPath = Astro.url.pathname;

const menuitems = [
  {
    title: "O mnie",
    path: "/#about",
  },
  {
    title: "Oferta",
    path: "/#offers",
  },
  {
    title: "Kontakt",
    path: "/#contact",
  },
  {
    title: "CV",
    path: "/cv",
  },
  {
    title: "Blog",
    path: "/blog",
  },
];

function isActive(itemPath: string): boolean {
  // Only highlight "O mnie" on homepage as the default section
  if (itemPath.startsWith("/#")) {
    return itemPath === "/#about" && currentPath === "/";
  }
  // Exact match for homepage
  if (itemPath === "/") {
    return currentPath === "/";
  }
  // Section matching for nested routes (e.g., /blog/post-slug highlights Blog)
  return currentPath.startsWith(itemPath);
}
---

<header
  data-testid="header"
  class="my-5 flex flex-col items-center justify-between lg:flex-row"
>
  <Astronav>
    <div class="flex w-full items-center justify-between lg:w-auto">
      <a
        href="/"
        class="whitespace-nowrap font-mono text-lg font-bold text-black hover:text-orange dark:text-white dark:hover:text-orange transition-colors duration-200 motion-reduce:transition-none"
        onclick="window.mixpanel?.track('Menu item clicked', { 'Item': 'Brand' })"
      >
        <span class="text-orange">Michalina</span> Graczyk
      </a>
      <div class="ml-2 block lg:hidden">
        <MenuIcon class="min-h-[44px] min-w-[44px] p-2 text-black dark:text-white" />
      </div>
    </div>
    <MenuItems class="mobile-menu mt-2 hidden w-full lg:mt-0 lg:flex lg:w-auto">
      <ul class="flex flex-col lg:flex-row lg:gap-3">
        {
          menuitems.map((item) => {
            const active = isActive(item.path);
            return (
              <li>
                <a
                  href={item.path}
                  aria-current={active ? "page" : undefined}
                  class:list={[
                    "flex min-h-[44px] items-center py-2 lg:min-h-0 lg:px-3",
                    "text-black hover:text-orange dark:text-white dark:hover:text-orange",
                    "transition-colors duration-200 motion-reduce:transition-none",
                    active && "border-b-2 border-orange text-orange",
                  ]}
                  onclick={`window.mixpanel?.track("Menu item clicked", { "Item": "${item.title}" })`}
                >
                  {item.title}
                </a>
              </li>
            );
          })
        }
        <li><ToggleTheme /></li>
      </ul>
    </MenuItems>
  </Astronav>
</header>

<style>
  /* Mobile menu animation */
  .mobile-menu:not(.hidden) {
    animation: menu-slide-in 250ms ease-out;
  }

  @keyframes menu-slide-in {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Respect reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .mobile-menu:not(.hidden) {
      animation: none;
    }
  }
</style>
