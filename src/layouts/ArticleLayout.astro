---
import Layout from "./Layout.astro";
import BackToTop from "@components/ui/BackToTop.astro";
import { Icon } from "astro-icon/components";

export interface Props {
  title: string;
  date: Date;
  excerpt: string;
  tags?: string[];
}

const { title, date, excerpt, tags } = Astro.props;

const formattedDate = date.toLocaleDateString("pl-PL", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<Layout title={`${title} | Blog`} description={excerpt} type="article">
  <main id="main-content" class="mb-20">
    <article class="mx-auto max-w-3xl px-4 py-8">
      <header class="mb-10">
        <div class="mb-6">
          <a
            href="/blog"
            class="inline-flex items-center gap-2 text-sm text-gray-600 transition-colors hover:text-orange dark:text-gray-400 dark:hover:text-orange"
          >
            <Icon name="mdi:arrow-left" class="h-4 w-4" />
            Wróć do bloga
          </a>
        </div>

        <h1 class="mb-3 text-3xl font-bold text-black dark:text-white lg:text-4xl">
          {title}
        </h1>
        <div class="mb-4 h-1 w-16 bg-orange"></div>

        <div class="flex flex-wrap items-center gap-3 text-sm text-gray-600 dark:text-gray-400">
          <div class="flex items-center gap-1.5">
            <Icon name="mdi:calendar" class="h-4 w-4 text-orange" />
            <time datetime={date.toISOString()}>{formattedDate}</time>
          </div>
          <span class="text-orange" aria-hidden="true">|</span>
          <div class="flex items-center gap-1.5">
            <Icon name="mdi:clock-outline" class="h-4 w-4 text-orange" />
            <span class="reading-time"></span>
          </div>
        </div>

        {
          tags && tags.length > 0 && (
            <div class="mt-5 flex flex-wrap gap-2">
              {tags.map((tag) => (
                <span class="rounded-full border border-orange/30 bg-orange/10 px-3 py-1 text-xs font-medium text-orange">
                  {tag}
                </span>
              ))}
            </div>
          )
        }
      </header>

      <div class="prose prose-lg dark:prose-invert max-w-none text-black dark:text-white">
        <slot />
      </div>

      <footer class="mt-12 border-t border-gray-200 pt-8 dark:border-gray-700">
        <a
          href="/blog"
          class="inline-flex items-center gap-2 font-medium text-orange transition-colors hover:underline"
        >
          <Icon name="mdi:arrow-left" class="h-5 w-5" />
          Zobacz wszystkie artykuły
        </a>
      </footer>
    </article>
    <BackToTop />
  </main>
</Layout>

<style>
  .prose :global(h2) {
    @apply mt-10 mb-4 text-2xl font-bold text-black dark:text-white;
    position: relative;
    padding-left: 1rem;
    border-left: 3px solid theme("colors.orange");
  }

  .prose :global(h3) {
    @apply mt-8 mb-3 text-xl font-bold text-orange;
  }

  .prose :global(p) {
    @apply mb-5 leading-relaxed;
  }

  .prose :global(ul),
  .prose :global(ol) {
    @apply mb-5 ml-6 space-y-2;
  }

  .prose :global(ul) {
    @apply list-disc;
  }

  .prose :global(ul li::marker) {
    color: theme("colors.orange");
  }

  .prose :global(ol) {
    @apply list-decimal;
  }

  .prose :global(ol li::marker) {
    color: theme("colors.orange");
    font-weight: 600;
  }

  .prose :global(li) {
    @apply leading-relaxed;
  }

  .prose :global(a) {
    @apply text-orange underline decoration-orange/50 underline-offset-2 hover:decoration-orange;
  }

  .prose :global(code) {
    @apply rounded bg-orange/10 px-1.5 py-0.5 font-monospace text-sm text-orange;
  }

  .prose :global(pre) {
    @apply mb-5 overflow-x-auto rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-900;
  }

  .prose :global(pre code) {
    background: transparent;
    padding: 0;
    color: inherit;
  }

  .prose :global(blockquote) {
    @apply mb-5 rounded-r-lg border-l-4 border-orange bg-orange/5 py-4 pl-4 pr-4 italic;
  }

  .prose :global(strong) {
    @apply font-bold text-orange;
  }

  .prose :global(hr) {
    @apply my-8 border-orange/30;
  }
</style>

<script>
  function calculateReadingTime() {
    const article = document.querySelector("article");
    if (!article) return;

    const text = article.textContent || "";
    const wordsPerMinute = 200;
    const words = text.trim().split(/\s+/).length;
    const minutes = Math.ceil(words / wordsPerMinute);

    const readingTimeEl = document.querySelector(".reading-time");
    if (readingTimeEl) {
      readingTimeEl.textContent = `${minutes} min czytania`;
    }
  }

  calculateReadingTime();
</script>
